<style>
    /*样式写这里*/
    .demo-table table tbody tr td span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 600px;
        display: block;
    }

    ::-webkit-scrollbar{
        display:none;
    }
    
    /*.table-header {*/
    /*    position: fixed;*/
    /*    top: 0;*/
    /*    z-index: 99*/
    /*}*/
    
    .conter_box {
        display: none;
    }

    .conter_box.active {
        display: block;
    }

    .config_file .CodeMirror {
        height: 400px;
    }

    .config_user_file .CodeMirror {
        height: 360px;
    }

    .logs_code_style {
        margin: 0px;
        background-color: #333;
        color: #fff;
        padding: 0 5px;
        width: 100%;
        height: 520px;
        line-height: 20px;
    }

    .select_list {
        width: 190px;
        height: 35px;
        line-height: 35px;
        border: 1px solid #888;
        border-radius: 2px;
        display: inline-block;
        cursor: pointer;
        position: relative;
        margin-left: 15px;
    }

    .select_list .select_item {
        width: 100%;
        display: block;
        /* text-align: center; */
        padding-left: 10px;
    }

    .select_list .select {
        width: 190px;
        position: absolute;
        left: -1px;
        top: 33px;
        border: 1px solid #999;
        background: #fff;
        max-height: 250px;
        overflow: auto;
    }

    .select_list .select li {
        height: 35px;
        line-height: 35px;
        padding: 0 10px;
    }

    .select_list .select li.active {
        background: #e6e6e6;
    }

    .select_list .select li:hover {
        background: #e6e6e6;
    }

    .install_version_box .btn-danger {
        color: #fff;
        background-color: #d9534f;
        border-color: #d43f3a;
    }

    .install_version_box {
        padding: 15px 25px;
    }

    .tomcat_log {
        margin: 0px;
        width: 100%;
        height: 370px;
        background-color: #424251;
        overflow: auto;
        line-height: 22px;
        color: #fff;
        padding-left: 10px;
        font-family: arial;
        margin-top: 10px;
        outline: none;
    }

    .dstserver_property .line .tname {
        width: 300px;
    }

    .dstserver_property .line {
        padding: 3px 0;
    }

    .dstserver_property .line .info-r {
        margin-bottom: 2px;
    }

    .box_table_conter {
        height: 402px;
        overflow: auto;
        width: 100%
    }
    .box_table_conter1 {
        height: 33px;
        overflow: auto;
        width: 100%
    }
    .box_table_conter2 {
        height: 452px;
        overflow: auto;
        width: 100%
    }

    .bt_conter .line {
        padding: 0px;
    }

   /*.cluster_settings {*/
   /*    overflow-y: auto;*/
   /*    height: 500px;*/
   /*}*/
   
   .cluster_setting_config {
       overflow-y: auto;
       height: 450px;
   }
   
   
   .shard_settings_config {
       overflow-y: auto;
       height: 450px;
   }
   .env_title {
        height: 24px;
        text-align: center;
        font-size: 16px;
        background-color: #efeff0;
        margin: 0 2px;
   }
   .mod_settings{
       /*overflow-y: auto;*/
       height: 500px;
   }
   .wnowrap {
        white-space: nowrap; 
        text-overflow: ellipsis; 
        overflow: hidden;
   }
</style>
<div class="bt-form">
    <div class="bt-w-main">
        <!--菜单部分-->
        <div class="bt-w-menu">
            <p>服务器列表</p>
            <p class="bgw">存档管理</p>
            <p>房间设置</p>
            <p>世界管理</p>
            <p>世界设置</p>
            <p>模组管理</p>
            <p>玩家管理</p>
            <p>控制面板</p>
            <p>系统设置</p>
            <p>交流反馈</p>
            <p>关于作者</p>
        </div>
        <!--内容部分-->
        <div class="bt-w-con pd15">
            <div class="plugin_body">
                <!-- 服务器列表 -->
                <div class="conter_box dstserver_list">
                    <button class="btn btn-success btn-sm va0 mb15 add_dstserver">添加服务器</button>
                    <div class="box_table_conter1 divtable">
                    <table class="table table-hover">
                        <thead class="table-header">
                        <tr>
                            <th>服务器名</th>
                            <th style="text-align:center;width: 100px;">IP</th>
                            <th style="text-align:center;width: 100px;">端口</th>
                            <th style="text-align:center;width: 100px;">用户名</th>
                            <th style="text-align:center;width: 150px;">密码</th>
                            <th style="text-align:right;width: 100px;">操作</th>
                        </tr>
                        </thead>
                    </table>
                    </div>
                    <div class="box_table_conter2 divtable">
                        <table class="table table-hover">
                            <tbody class="dstserver_table"></tbody>
                        </table>
                    </div>
                </div>
                <!-- 存档管理 -->
                <div class="conter_box dstcluster_list">
                    <button class="btn btn-success btn-sm va0 mb15 add_dstcluster">新建存档</button>
                    <button class="btn btn-info btn-sm va0 mb15 import_dstcluster" style="float: right;">导入存档</button>
                    <div class="box_table_conter1 divtable">
                        <table class="table table-hover">
                            <thead class="table-header">
                            <tr>
                                <th>存档名</th>
                                <th style="text-align:center;width: 80px;">状态</th>
                                <th style="text-align:center;width: 100px;">存档位置</th>
                                <th style="text-align:center;width: 100px;">创建时间</th>
                                <th style="text-align:right;width: 260px;">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="box_table_conter2 divtable">
                        <table class="table table-hover">
                            <tbody class="dstcluster_table"></tbody>
                        </table>
                    </div>
                </div>
                <!-- 房间设置 -->
                <div class="conter_box cluster_settings"></div>
                <!-- 世界管理 -->
                <div class="conter_box shard_manager">
                    <button class="btn btn-success btn-sm va0 mb15 add_dstshard">添加世界</button>
                    <span class="shard_cluster" style="font-size: 18px; margin-left: 5px;"></span>
                    <div class="cluster-shard-id" style="display:none;"></div>
                    <div class="box_table_conter1 divtable">
                        <table class="table table-hover">
                            <thead class="table-header">
                            <tr>
                                <th>世界名</th>
                                <th style="text-align:center;width: 80px;">主世界</th>
                                <th style="text-align:center;width: 80px;">类型</th>
                                <th style="text-align:center;width: 80px;">端口号</th>
                                <th style="text-align:center;width: 80px;">世界ID</th>
                                <th style="text-align:center;width: 120px;">Steam服务端口</th>
                                <th style="text-align:center;width: 120px;">Steam认证端口</th>
                                <th style="text-align:right;width: 160px;">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="box_table_conter2 divtable">
                        <table class="table table-hover">
                            <tbody class="dstshard_table"></tbody>
                        </table>
                    </div>
                </div>
                <!-- 世界环境设置 -->
                <div class="conter_box shard_settings"></div>
                <!-- 模组设置 -->
                <div class="conter_box mod_settings">
                    <div class="mod-cluster mb15"></div>
                    <button class="btn btn-success btn-sm va0 mb15 upload_dst_mod_btn">上传MOD</button>
                    <input class="bt-input-text mr5 mb15 dst-modid-input" type="text" style="width:200px;" placeholder="请输入MODID">
                    <button class="btn btn-success btn-sm va0 mb15 add_dst_mod_btn">添加MOD</button>
                    <button class="btn btn-success btn-sm va0 mb15 search_dst_mod_btn" style="float: right;">查找</button>
                    <input class="bt-input-text mr5 mb15 search-dst-modid-input" type="text" style="width:250px;float: right;" placeholder="请输入MODID或名称">
                    <div class="box_table_conter1 divtable">
                        <table class="table table-hover">
                            <thead class="table-header">
                            <tr>
                                <th>MOD名称</th>
                                <th style="text-align:center;width: 60px;">状态</th>
                                <th style="text-align:center;width: 60px;">配置</th>
                                <th style="text-align:center;width: 80px;">加载类型</th>
                                <th style="text-align:center;width: 60px;">位置</th>
                                <th style="text-align:center;width: 120px;">作者</th>
                                <th style="text-align:center;width: 100px;">版本</th>
                                <th style="text-align:right;width: 60px;">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="box_table_conter divtable">
                        <table class="table table-hover">
                            <tbody class="dstmod_table"></tbody>
                        </table>
                    </div>
                </div>
                <!-- 玩家管理 -->
                <div class="conter_box player_manager">
                    <!--<div class="player_manager_list mb15"></div>-->
                    <button class="btn btn-success btn-sm va0 mb15 add_list_player_btn">添加</button>
                    <button class="btn btn-success btn-sm va0 mb15 search_list_player_btn" style="float: right;">查找</button>
                    <input class="bt-input-text mr5 mb15 search-list_player-input" type="text" style="width:250px;float: right;" placeholder="请输入玩家ID或昵称">
                    <div class="box_table_conter1 divtable">
                        <table class="table table-hover">
                            <thead class="table-header">
                            <tr>
                                <th style="width: 100px;">KleiID</th>
                                <th style="text-align:center;width: 120px;">昵称</th>
                                <th>Steam64位ID</th>
                                <th style="text-align:center;width: 80px;">管理员</th>
                                <th style="text-align:center;width: 80px;">白名单</th>
                                <th style="text-align:center;width: 80px;">黑名单</th>
                                <th style="text-align:center;width: 80px;">来源</th>
                                <th style="text-align:right;width: 100px;">操作</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="box_table_conter divtable">
                        <table class="table table-hover">
                            <tbody class="dst_list_player_table"></tbody>
                        </table>
                    </div>
                </div>
                <!-- 控制面板 -->
                <div class="conter_box console_panel"></div>
                <!-- 系统设置 -->
                <div class="conter_box sys_settings"></div>
                <!-- 交流反馈 -->
                <div class="conter_box bug_report"></div>
                <!-- 关于作者 -->
                <div class="conter_box about_me"></div>
            </div>
        </div>
    </div>
</div>


<!--JS脚本部分，不要将JS脚本写在其它地方-->
<script type="text/javascript" src="/static/js/clipboard.min.js"></script>
<script type="text/javascript" src="/static/js/upload.js"></script>
<script type="text/javascript">
    var dst = {
        plugin_name: 'dst_manager',
        cluster_data: {},
        shard_data: {},
        sever_list: {},
        cur_cluster: {},
        shard_env_data: {},
        sys_setting_data: {},
        mod_list_data: {},
        mod_path: "",
        haslisence: false,
        init: function () {
            var _this = this;
            
            _this.get_sys_setting_req(function (res) {
                var data = res.data;
                sys_setting_data = data;
                var flag = false;
                if (data.lisence == "false"){
                    layer.msg('未授权！', {icon: 0});
                    flag = true;
                } else {
                    haslisence = true;
                    if (data.curversion == ""){
                        layer.msg('游戏服务端未安装，请先安装！', {icon: 0});
                        flag = true;
                    }
                }
                if (flag) {
                    $(".bt-w-menu p").eq(8).addClass('bgw').siblings().removeClass('bgw');
                    $('.conter_box').eq(8).show().siblings().hide();
                    _this.create_system_setting_view();
                }
            });
            
            _this.get_mod_path(function (res) { if (res.status) {mod_path = res.data;} });

            $('.conter_box').eq(1).show();
            _this.create_dstcluster_view();

            //左测菜单切换效果
            $('.layui-layer-page').width('1000px');

            $(".bt-w-menu p").click(function () {
                var index = $(this).index();
                if (sys_setting_data.curversion == ""){
                    layer.msg('游戏服务端未安装，请先安装！', {icon: 0});
                    index = 8;
                }
                if (!haslisence){
                    layer.msg('插件未授权，请先授权！', {icon: 0});
                    index = 8;
                }
                if (typeof cur_cluster == 'undefined' ){
                    if ( index > 1 && index < 8){
                        if ( index == 4 ){
                            layer.msg('请从世界管理页面进入修改！', {icon: 0});
                        }else{
                            layer.msg('请从存档管理页面进入修改！', {icon: 0});
                        }
                        index = 1;
                    }
                }else{
                    if ( index == 4 ){
                        layer.msg('请从世界管理页面进入修改！', {
                            icon: 0,
                            time: 1000 //2秒关闭（如果不配置，默认是3秒）
                        });
                        index = 3;
                    }
                }
                $(".bt-w-menu p").eq(index).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(index).show().siblings().hide();
                // if ( typeof cur_index == 'undefined' || cur_index == "" || cur_index != index){
                    switch (index) {
                        case 0:
                            _this.create_dstserver_view();
                            break;
                        case 1:
                            _this.create_dstcluster_view();
                            break;
                        case 2:
                            _this.create_dstcluster_settings_view(cur_cluster);
                            break;
                        case 3:
                            _this.create_dstshard_view(cur_cluster);
                            break;
                        case 4:
                            _this.create_dstcluster_view();
                            break;
                        case 5:
                            _this.create_dstcluster_mod_view(cur_cluster);
                            break;
                        case 6:
                            _this.create_dstcluster_player_list_view();
                            break;
                        case 8:
                            _this.create_system_setting_view();
                            break;
                        case 7:
                            break;
                    }
                // }
                // cur_index = index;
                // console.log(cur_index+' '+index);
            });

            // 新建存档
            $('.add_dstcluster').click(function () {
                var cluster_folder = bt.get_random(8);

                _this.add_dstcluster_req({
                    clusterfolder: cluster_folder,
                }, function (res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                    if (res.status) {
                        _this.create_dstcluster_view(function () {
                            layer.msg(res.data, {icon: 1});
                        })
                    }
                });
            });

            // 添加服务器
            $('.add_dstserver').click(function () {
                var args = {
                    "title": "添加服务器",
                    "type": "add",
                    "dstserver": "",
                    "username": "root",
                    "password": "",
                    "dst_port": "22",
                    "dst_ip": "127.0.0.1",
                };
                _this.open_server_info_dialog(args);
            });
            
             $('.add_list_player_btn').click(function () {
                var args = {
                        "title": "添加玩家",
                        "kleiID": "kleiID",
                        "nickname": "昵称",
                        "steamid": "Steam64位ID",
                        "admin": "false",
                        "white": "false",
                        "black": "false",
                        "origin": "自建"
                    };
                _this.open_player_info_dialog(args);
            });
            
            $('.sys_settings').on('click', '.save_dstserver_token', function() {
                var t = $('.server-token').val();
                sys_setting_data.token = t;
                _this.set_sys_setting_req({"token": t}, function(res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                });
            });
            
            $('.sys_settings').on('click', '.save_game_version', function() {
                var t = $('.server-beta').val();
                var t1 = $('.server-beta-code').val();
                sys_setting_data.beta = t;
                sys_setting_data.betacode = t1;
                _this.set_sys_setting_req({"beta": t, "betacode": t1}, function(res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                });
            });
            
            $('.sys_settings').on('click', '.save_sc', function() {
                var t = $('.server-chan-key').val();
                var t1 = $('.server-chan').val();
                sys_setting_data.sckey = t;
                sys_setting_data.sc = t1;
                _this.set_sys_setting_req({"sckey": t, "sc": t1}, function(res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                });
            });
            
            $('.sys_settings').on('click', '.save_lisence_key', function() {
                var t = $('.plugin-lisence-key').val();
                sys_setting_data.lic = t;
                _this.set_sys_setting_req({"lic": t, "savelic": "true"}, function(res) {
                    if (res.status) { haslisence = true; }
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                });
            });
            
            $('.sys_settings').on('click', '.check_server_update', function() {
                _this.check_server_update();
            });
            
            $('.sys_settings').on('click', '.check_plugin_update', function() {
                if (sys_setting_data.newpluginversion != "" && sys_setting_data.curpluginversion != sys_setting_data.newpluginversion){
                    _this.update_plugin_req(function(res){
                        layer.msg(res.data, {icon: res.status ? 1 : 2});
                    })
                }else{
                    layer.msg("插件不需要更新！", {icon: 1});
                }
            });
            
            $('.sys_settings').on('click', '.server_update', function() {
                var args = {"title": "正在安装或更新服务器游戏客户端 ...", "t": "install", "time": 5000};
                _this.server_operation(args);
            });
            
            $('.sys_settings').on('click', '.validate_server', function() {
                var args = {"title": "正在验证服务器游戏客户端完整性 ...", "t": "install", "time": 5000};
                _this.server_operation(args);
            });
            
            $('.sys_settings').on('click', '.uninstall_server', function() {
                var args = {"title": "正在卸载服务器游戏客户端 ...", "t": "uninstall", "time": 1000};
                _this.server_operation(args);
            });

            // 添加世界
            $('.add_dstshard').click(function () {
                var clusterid = $('.cluster-shard-id').text();
                var args = {
                    "clusterid": clusterid,
                    "shardid": "",
                    "title": "添加世界"
                }
                _this.open_shard_info_dialog(args);
            });
            
            // 保存环境设置
            $('.shard_settings').on('click', '.save_shard_env_data', function(){
                var rdata = shard_env_data['overrides'];
                for (var i = 0; i < rdata.length; i++) {
                    if (rdata[i].type != "other"){
                        rdata[i].value = $('.'+rdata[i].name+'-env').val();
                    }
                }
                _this.save_shard_env_data_req(rdata, function (res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                    if (res.status){
                        $(".bt-w-menu p").eq(3).addClass('bgw').siblings().removeClass('bgw');
                        $('.conter_box').eq(3).show().siblings().hide();
                        _this.create_dstshard_view(cur_cluster);
                    }
                });
            })

            // 修改世界信息
            $('.dstshard_table').on('click', '.edit_shard_setting', function () {
                var clusterid = $('.cluster-shard-id').text();
                //获得当前行
                var currentRow = $(this).closest("tr");
                var shardid = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var args = {
                    "clusterid": clusterid,
                    "shardid": shardid,
                    "title": "修改世界信息"
                }
                _this.open_shard_info_dialog(args);
            });
            
            // 上传MOD
            $('.mod_settings').on('click', '.upload_dst_mod_btn', function () {
                bt_upload_file.open(mod_path, null, null, function () {
                    _this.create_dstcluster_mod_view(cur_cluster);
                });
                return;
            });
            
            // 搜索MOD
            $('.mod_settings').on('click', '.search_dst_mod_btn', function () {
                var args = $('.search-dst-modid-input').val();
                _this.search_dstcluster_mod_view(args);
            });
            
            // 删除MOD
            $('.dstmod_table').on('click', '.del_mod', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var moddir = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var name = currentRow.find("td:eq(0)").text();
                var args = {"moddir": moddir};
                var confirm = layer.open({
                    closeBtn: 2,
                    icon: 0,
                    title: '删除MOD',
                    area: '450px', //宽高
                    btn: ['确定', '取消'],
                    content: '<div class="bt_conter bt-form" style="margin-top:-5px;margin-left:15px;">\
                                <div class="line">确定要删除MOD['+name+']吗?</div>\
                            </div>',
                    yes: function (index, layero) {
                        layer.close(confirm);
                        _this.del_mod_req(args, function (res) {
                            layer.msg(res.data, {icon: res.status ? 1 : 2});
                            if (res.status){
                                _this.create_dstcluster_mod_view(cur_cluster);
                            }
                        });
                    }
                });
            });
            
            // 配置MOD
            $('.dstmod_table').on('click', '.config_mod', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var moddir = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var modname = currentRow.find("td:eq(0)").text(); //获得当前行第二个TD值
                var args = {"moddir": moddir, "clusterid": cur_cluster.id, "modname": modname};
                _this.open_mod_config_dialog(args);
            });
            
            // 启用MOD
            $('.dstmod_table').on('click', '.enable_mod', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var moddir = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var args = {"moddir": moddir, "clusterid": cur_cluster.id, "used": true};
                _this.switch_mod_status_req(args, function (res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                    if (res.status){
                        _this.create_dstcluster_mod_view(cur_cluster);
                    }
                });
            });
            
             // 禁用MOD
            $('.dstmod_table').on('click', '.disable_mod', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var moddir = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var args = {"moddir": moddir, "clusterid": cur_cluster.id, "used": false};
                _this.switch_mod_status_req(args, function (res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                    if (res.status){
                        _this.create_dstcluster_mod_view(cur_cluster);
                    }
                });
            });
            
            // 修改世界环境
            $('.dstshard_table').on('click', '.edit_shard_env', function () {
                var clusterid = $('.cluster-shard-id').text();
                //获得当前行
                var currentRow = $(this).closest("tr");
                var shardid = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var shardtype = currentRow.find("td:eq(2)").text(); //获得当前行第二个TD值
                var shardname = currentRow.find("td:eq(0)").text(); //获得当前行第二个TD值
                $(".bt-w-menu p").eq(4).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(4).show().siblings().hide();
                var args = {
                    "clusterid": clusterid,
                    "shardid": shardid,
                    "shardtype": shardtype,
                    "shardname": shardname
                }
                _this.create_dstshard_env_config_view(args);
            });
            
            // 删除世界
            $('.dstshard_table').on('click', '.del_shard', function () {
                var clusterid = $('.cluster-shard-id').text();
                //获得当前行
                var currentRow = $(this).closest("tr");
                var shardid = currentRow.find("td:eq(8)").text(); //获得当前行第二个TD值
                var args = {
                    "clusterid": clusterid,
                    "shardid": shardid
                }
                var confirm = layer.open({
                    closeBtn: 2,
                    icon: 0,
                    title: '删除世界',
                    area: '450px', //宽高
                    btn: ['确定', '取消'],
                    content: '<div class="bt_conter bt-form" style="margin-top:-5px;margin-left:15px;">\
                                <div class="line">确定要删除该世界吗?</div>\
                            </div>',
                    yes: function (index, layero) {
                        layer.close(confirm);
                        _this.del_shard_req(args, function (res) {
                            layer.msg(res.data, {icon: res.status ? 1 : 2});
                            if (res.status){
                                _this.create_dstshard_view(cur_cluster);
                            }
                        });
                    }
                });
            });

            // 保存房间设置
            $('.cluster_settings').on('click', '.save_cluster_data', function () {
                var rdata = cluster_data;
                for (var i = 0; i < rdata.length; i++) {
                    if (rdata[i].opreate != "readonly"){
                        rdata[i].value = $('.'+rdata[i].name).val();
                    }
                }
                _this.save_cluster_data_req(rdata, function (res) {
                    layer.msg(res.data, {icon: res.status ? 1 : 2});
                    if (res.status){
                        $(".bt-w-menu p").eq(1).addClass('bgw').siblings().removeClass('bgw');
                        $('.conter_box').eq(1).show().siblings().hide();
                        _this.create_dstcluster_view();
                    }
                });
            });

            // 设置密码显示(OK)
            $('.dstserver_table').on('click', '.set_paw_ico', function () {
                var paw = $(this).prev().attr('data-paw')
                if ($(this).hasClass('glyphicon-eye-open')) {
                    $(this).addClass('glyphicon-eye-close').removeClass('glyphicon-eye-open').prev().html(paw);
                } else {
                    $(this).addClass('glyphicon-eye-open').removeClass('glyphicon-eye-close').prev().html('******');
                }
            });

            // 修改服务器信息
            $('.dstserver_table').on('click', '.change_dstserver', function () {
                var args = {
                    "dstserver": $(this).attr('data-dstserver'),
                    "username": $(this).attr('data-username'),
                    "password": $(this).attr('data-password'),
                    "dst_port": $(this).attr('data-port'),
                    "dst_ip": $(this).attr('data-ip'),
                    "title": '修改服务器[' + $(this).attr('data-dstserver') + ']',
                    "type": "edit",
                }
                _this.open_server_info_dialog(args);
            });

            // 删除服务器
            $('.dstserver_table').on('click', '.del_dstserver', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var dstserver = currentRow.find("td:eq(0)").text(); //获得当前行第二个TD值
                var ip = currentRow.find("td:eq(1)").text(); //获得当前行第二个TD值
                var confirm = layer.open({
                    closeBtn: 2,
                    icon: 0,
                    title: '删除服务器',
                    area: '450px', //宽高
                    btn: ['确定', '取消'],
                    content: '<div class="bt_conter bt-form" style="margin-top:-5px;margin-left:15px;">\
                                <div class="line">确定要删除服务器[' + dstserver + '(' + ip + ')]吗?</div>\
                            </div>',
                    yes: function (index, layero) {
                        layer.close(confirm);
                        _this.del_dstserver_req({ip: ip}, function (res) {
                            _this.create_dstserver_view(function () {
                                layer.msg(res.data, {icon: res.status ? 1 : 2});
                            });
                        });
                    }
                });
            });

            // 删除存档
            $('.dstcluster_table').on('click', '.del_dstcluster', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var dstcluster = currentRow.find("td:eq(0)").text(); //获得当前行第二个TD值
                var clusterID = currentRow.find("td:eq(5)").text();
                var confirm = layer.open({
                    closeBtn: 2,
                    icon: 0,
                    title: '删除存档',
                    area: '450px', //宽高
                    btn: ['确定', '取消'],
                    content: '<div class="bt_conter bt-form" style="margin-top:-5px;margin-left:15px;">\
                                <div class="line">确定要删除存档[' + dstcluster + ']吗?</div>\
                                <div class="line" style="padding:0;">\
                                    <div class="c4" style="margin-bottom:0;display:inline-block;text-align:left;">\
                                        <input type="checkbox" name="del_cluster_bak">\
                                    </div>\
                                    <span style="width:170px;color:red;padding-left:10px;">同时存档备份文件</span>\
                                </div>\
                            </div>',
                    yes: function (index, layero) {
                        var del_cluster_bak = $('[name="del_cluster_bak"]').prop('checked') ? 1 : 0;
                        layer.close(confirm);
                        _this.del_dstcluster_req({clusterid: clusterID, del_cluster_bak: del_cluster_bak}, function (res) {
                            _this.create_dstcluster_view(function () {
                                layer.msg(res.data, {icon: res.status ? 1 : 2});
                            });
                        });
                    }
                });
            });

            // 下载存档
            $('.dstcluster_table').on('click', '.download_cluster', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var clusterID = currentRow.find("td:eq(5)").text();
                _this.download_dstcluster_req({clusterid: clusterID}, function (res) {
                    if (!res.status){
                        layer.msg(res.data, {icon: 2});
                    }else{
                        window.open('/download?filename='+res.data, '_blank').location;
                    }
                });
            });

            // 获取存档房间设置
            $('.dstcluster_table').on('click', '.cluster_setting', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var clusterID = currentRow.find("td:eq(5)").text();
                var name = currentRow.find("td:eq(0)").text();
                $(".bt-w-menu p").eq(2).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(2).show().siblings().hide();
                cur_cluster = {"id": clusterID, "name": name};
                _this.create_dstcluster_settings_view(cur_cluster);
            });

            // 世界管理
            $('.dstcluster_table').on('click', '.shards_manager', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var clusterID = currentRow.find("td:eq(5)").text();
                var name = currentRow.find("td:eq(0)").text();
                $(".bt-w-menu p").eq(3).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(3).show().siblings().hide();
                cur_cluster = {"id": clusterID, "name": name};
                _this.create_dstshard_view(cur_cluster);
            });
            
            $('.dst_list_player_table').on('click', '.modify_player_list', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var args = {
                        "title": "修改玩家信息",
                        "kleiID": currentRow.find("td:eq(0)").text(),
                        "nickname": currentRow.find("td:eq(1)").text(),
                        "steamid": currentRow.find("td:eq(2)").text(),
                        "admin": currentRow.find("td:eq(3)").text().trim() == "是" ? "true" : "false",
                        "white": currentRow.find("td:eq(4)").text().trim() == "是" ? "true" : "false",
                        "black": currentRow.find("td:eq(5)").text().trim() == "是" ? "true" : "false",
                        "origin": currentRow.find("td:eq(6)").text()
                    };
                _this.open_player_info_dialog(args);
            });
            
            $('.dst_list_player_table').on('click', '.del_player_list', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var args = {
                        "kleiID": currentRow.find("td:eq(0)").text()
                    };
                _this.del_dstplayer_list_req(args, function(res){
                    if (res.status){
                        layer.msg(res.data, {icon: res.status ? 1 : 2});
                        _this.create_dstcluster_player_list_view();
                    }
                });
            });
            
            // MOD管理
            $('.dstcluster_table').on('click', '.mod_manager', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var clusterID = currentRow.find("td:eq(5)").text();
                var name = currentRow.find("td:eq(0)").text();
                $(".bt-w-menu p").eq(5).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(5).show().siblings().hide();
                cur_cluster = {"id": clusterID, "name": name};
                _this.create_dstcluster_mod_view(cur_cluster);
            });
            
            // MOD管理
            $('.dstcluster_table').on('click', '.player_list_manager', function () {
                $(".bt-w-menu p").eq(6).addClass('bgw').siblings().removeClass('bgw');
                $('.conter_box').eq(6).show().siblings().hide();
                _this.create_dstcluster_player_list_view();
            });
            
            // startorstop
            $('.dstcluster_table').on('click', '.startorstop', function () {
                //获得当前行
                var currentRow = $(this).closest("tr");
                var clusterID = currentRow.find("td:eq(5)").text();
                _this.startorstop_server_req({"clusterid": clusterID}, function(res){
                    if (res.status){
                        layer.msg(res.data, {icon: res.status ? 1 : 2});  
                    }
                });
            });
            
            $.getScript("/static/js/bt_upload.js", function() {});
        },

        server_operation:function(data){
            var pageTimer = 0;
            var _this = this;
            var confirm = layer.open({
                closeBtn: 1,
                icon: 0,
                type: 1,
                title: data.title,
                area:  ['700px', '500px'], //宽高
                content: '<textarea id="dst_install_logs_val" class="logs_code_style"></textarea>',
                success: function (layero, index) {
                    // 初始化执行
                    _this.server_update_req({"t": data.t, tips: "hide"}, function(res) {
                        if (res.status){
                            setTimeout(function(){
                                layer.msg(res.data, {icon: res.status ? 1 : 2});
                                if (data.t == "uninstall") {
                                    sys_setting_data.curversion = "未安装";
                                }
                                else {
                                    sys_setting_data.curversion = sys_setting_data.newversion;
                                }
                                _this.create_system_setting_view();
                                setTimeout(function(){
                                    clearInterval(pageTimer);
                                }, data.time);
                            }, 2000);
                        }else{
                            clearInterval(pageTimer);
                            layer.close(confirm);
                            layer.msg(res.data, {icon: res.status ? 1 : 2});
                        }
                    });
                    pageTimer = setInterval(function() {
                        _this.get_server_log({"t": "dst"}, function (res) {
                            document.getElementById("dst_install_logs_val").value = res.data;
                            var scrollDom = document.getElementById('dst_install_logs_val');
                            scrollDom.scrollTop = scrollDom.scrollHeight;
                        });
                    }, data.time);
                },
                end: function(){
                    clearInterval(pageTimer);
                },
            });
        },

        // 表头固定
    	table_sroll_fixed:function(select){
    		//表格头固定
    		var tableName = document.querySelector(select);
    		tableName.addEventListener('scroll',function(e){
    			var scrollTop = this.scrollTop;
    			$(this).find("thead").css({"transform":"translateY("+scrollTop+"px)","position":"relative","z-index":"1"});
    		});
    	},

        // 随机数
        randomNum: function(minNum,maxNum){ 
            switch(arguments.length){ 
                case 1: 
                    return parseInt(Math.random()*minNum+1,10); 
                break; 
                case 2: 
                    return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10); 
                break; 
                    default: 
                        return 0; 
                    break; 
            } 
        },
        
        check_server_update: function(){
            this.get_sys_setting_req(function (res) {
                sys_setting_data = res.data;
                $('.server-version').val(sys_setting_data.curversion);
                $('.server-version-new').val(sys_setting_data.newversion);
                if (sys_setting_data.curversion == "" || sys_setting_data.curversion != sys_setting_data.newversion){
                    layer.msg("服务器游戏客户端未安装或需要更新！", {icon: 2});
                }
            });
        },
        
        create_dstcluster_player_list_view: function(callback){
            // $('.player_manager_list').html('<span style="font-size: 20px; line-height: 24px;">存档['+data.name+']MOD管理</span>');
            var _html = '';
            this.get_dstplayer_list(function (res) {
                var rdata = res.data;
                for (var i = 0; i < rdata.length; i++) {
                    _html += '<tr>\
                        <td style="width: 100px;">' + rdata[i].kleiID + '</td>\
                        <td style="text-align:center;width: 120px;">' + rdata[i].nickname + '</td>\
                        <td>' + rdata[i].steamid + '</td>\
                        <td style="width: 80px; text-align:center;" align="center">\
						    <span>' + (rdata[i].admin == "true" ? '是':'否') +'</span>\
                        </td>\
                        <td style="width: 80px; text-align:center;" align="center">\
						    <span>' + (rdata[i].white == "true" ? '是':'否') +'</span>\
                        </td>\
                        <td style="width: 80px; text-align:center;" align="center">\
						    <span>' + (rdata[i].black == "true" ? '是':'否') +'</span>\
                        </td>\
                        <td style="text-align:center;width: 80px;">' + rdata[i].origin + '</td>\
                        <td style="text-align:right;width: 100px;">\
                            <a href="javascript:;" class="btlink modify_player_list">修改</a>&nbsp;|&nbsp;\
                            <a href="javascript:;" class="btlink del_player_list">删除</a>\
                        </td>\
                    </tr>';
                }
                $('.dst_list_player_table').html(_html);
                if (callback) callback();
            });
        },
        // 设置视图
        create_system_setting_view: function(callback){
            // console.log("dsds");
            var _html = '';
            if (typeof sys_setting_data == 'undefined' || sys_setting_data == ''){
                this.get_sys_setting_req(function (res) {
                    sys_setting_data = res.data;
                });
            }
                    _html += '<div class="line">\
            			    <span class="tname" style="padding-right: 10px;width:80px">插件版本号</span>\
            			    <div class="info-r c4">\
            				    <input class="bt-input-text mr5 plugin-version" disabled type="text" style="width:100px;" placeholder="未安装">\
            				    <span style="width:80px">最新版本号</span>\
            				    <input class="bt-input-text mr5 plugin-version-new" disabled type="text" style="color:red;width:100px;" placeholder="">\
            				    <button class="btn btn-success btn-sm va0 check_plugin_update">更新</button>\
            				</div>\
                    <div class="line">\
            		    <span class="tname" style="padding-right: 10px;width:80px">服务器令牌</span>\
            			<div class="info-r c4">\
            			    <input class="bt-input-text mr5 server-token" type="text" style="width:700px;" placeholder="请输入服务器令牌">\
            				    <button class="btn btn-success btn-sm va0 save_dstserver_token">保存令牌</button>\
            				</div>\
            			</div>\
            		    <div class="line">\
            			    <span class="tname" style="padding-right: 10px;width:80px">是否测试版</span>\
            				<div class="info-r c4">\
            				    <select class="server-beta bt-input-text" style="width:50px">\
            				        <option value="false" '+(sys_setting_data.beta == "false" ? "selected" : "")+'>否</option>\
            				        <option value="true" '+(sys_setting_data.beta == "true" ? "selected" : "")+'>是</option>\
            				    </select>\
            				    <input class="bt-input-text mr5 server-beta-code" type="text" style="width:150px;" placeholder="请输入测试代码">\
            				    <button class="btn btn-success btn-sm va0 save_game_version">保存</button>\
            				</div>\
            			</div>\
            			<div class="line">\
            			    <span class="tname" style="padding-right: 10px;width:92px">服务器版本号</span>\
            			    <div class="info-r c4">\
            				    <input class="bt-input-text mr5 server-version" disabled type="text" style="width:100px;" placeholder="未安装">\
            				    <span style="width:80px">最新版本号</span>\
            				    <input class="bt-input-text mr5 server-version-new" disabled type="text" style="color:red;width:100px;" placeholder="">\
            				    <button class="btn btn-success btn-sm va0 check_server_update">检查更新</button>\
            				    <button class="btn btn-success btn-sm va0 server_update">安装/更新游戏服务端</button>\
            				    <button class="btn btn-success btn-sm va0 validate_server">验证完整性</button>\
            				    <button class="btn btn-success btn-sm va0 uninstall_server">卸载</button>\
            				    <button class="btn btn-success btn-sm va0 all_mod_update">更新所有已安装MOD</button>\
            				</div>\
            				<div class="line">\
            		    <span class="tname" style="padding-right: 10px;width:92px">Server酱通知</span>\
            			<div class="info-r c4">\
            				    <select class="server-chan bt-input-text" style="width:90px">\
            				        <option value="false" '+(sys_setting_data.sc == "false" ? "selected" : "")+'>关闭</option>\
            				        <option value="true" '+(sys_setting_data.sc == "true" ? "selected" : "")+'>开启</option>\
            				    </select>\
            				    <input class="bt-input-text mr5 server-chan-key" type="text" style="width:618px;" placeholder="请输入Server酱秘钥">\
            				    <button class="btn btn-success btn-sm va0 save_sc">保存</button>\
            				</div>\
            				<!--<div class="line">\
            		    <span class="tname" style="padding-right: 10px;width:92px">插件授权秘钥</span>\
            			<div class="info-r c4">\
            				    <input class="bt-input-text mr5 plugin-lisence-key" type="text" style="width:712px;" placeholder="插件授权秘钥">\
            				    <button class="btn btn-success btn-sm va0 save_lisence_key">保存</button>\
            				</div>-->\
            	</div>';
                $('.sys_settings').html(_html);
                $('.server-token').val(sys_setting_data.token);
                $('.server-beta-code').val(sys_setting_data.betacode);
                $('.server-version').val(sys_setting_data.curversion);
                $('.server-version-new').val(sys_setting_data.newversion);
                $('.plugin-version').val(sys_setting_data.curpluginversion);
                $('.plugin-version-new').val(sys_setting_data.newpluginversion);
                $('.server-chan-key').val(sys_setting_data.sckey);
                $('.plugin-lisence-key').val(sys_setting_data.lic);
                if (sys_setting_data.curversion != "" && sys_setting_data.curversion != sys_setting_data.newversion){
                    layer.msg("服务器游戏客户端未安装或需要更新！", {icon: 2});
                }
                if (callback) callback();
        },
        
        // 创建存档MOD列表视图
        create_dstcluster_mod_view: function(data, callback){
            $('.mod-cluster').html('<span style="font-size: 20px; line-height: 24px;">存档['+data.name+']MOD管理</span>');
            var _html = '';
            this.get_cluster_mod_list_req({"clusterid": data.id}, function(res) {
                var rdata = res.data;
                mod_list_data = rdata;
                for (var i = 0; i < rdata.length; i++) {
                    _html += '<tr>\
                        <td class="wnowrap" title="' + rdata[i].name + '">' + rdata[i].name + '</td>\
                        <td style="width: 60px; text-align:center;" align="center" title="点击'+ (rdata[i].enabled == "true" ? "禁用":"启用") +'">\
                            <span>' + (rdata[i].enabled == "true" ? '<a href="javascript:;" class="btlink disable_mod">启用</a>':'<a href="javascript:;" class="btlink enable_mod">禁用</a>') +'</span>\
                        </td>\
                        <td style="width: 60px; text-align:center;" align="center" title="点击配置MOD选项">\
						    <span>' + (rdata[i].configable ? '<a href="javascript:;" class="btlink config_mod">配置</a>':'配置') +'</span>\
						</td>\
						<td style="width: 80px; text-align:center;">' + rdata[i].load_type + '</td>\
						<td style="text-align:center;width: 60px;" title="点击打开MOD路径">\
                            <span onclick="openPath(&quot;'+rdata[i].path+'&quot;)" class="glyphicon glyphicon-folder-open cursor"></span></td>\
						<td class="wnowrap" style="max-width: 120px; width: 120px;text-align:center;" title="' + rdata[i].author + '">' + rdata[i].author + '</td>\
						<td style="width: 100px; text-align:center;">' + rdata[i].version + '</td>\
                        <td style="text-align:right; width: 60px;">\
                            <a href="javascript:;" class="btlink del_mod">删除</a>\
                        </td>\
                        <td style="display:none;">' + rdata[i].moddir + '</td>\
                    </tr>'
                }
                $('.dstmod_table').html(_html);
                if (callback) callback();
            });
        },
        
        // 创建存档MOD列表视图
        search_dstcluster_mod_view: function(args){
            if (typeof mod_list_data != 'undefined' && args != ''){
                var rdata = mod_list_data;
                var _html = '';
                for (var i = 0; i < rdata.length; i++) {
                    var id = rdata[i].moddir;
                    var name = rdata[i].name;
                    if (id.indexOf(args) > -1 || name.indexOf(args) > -1){
                    _html += '<tr>\
                        <td class="wnowrap" title="' + rdata[i].name + '">' + rdata[i].name + '</td>\
                        <td style="width: 60px; text-align:center;" align="center" title="点击'+ (rdata[i].enabled == "true" ? "禁用":"启用") +'">\
                            <span>' + (rdata[i].enabled == "true" ? '<a href="javascript:;" class="btlink disable_mod">启用</a>':'<a href="javascript:;" class="btlink enable_mod">禁用</a>') +'</span>\
                        </td>\
                        <td style="width: 60px; text-align:center;" align="center" title="点击配置MOD选项">\
    					    <span>' + (rdata[i].configable ? '<a href="javascript:;" class="btlink config_mod">配置</a>':'配置') +'</span>\
    					</td>\
    					<td style="width: 80px; text-align:center;">' + rdata[i].load_type + '</td>\
    					<td style="text-align:center;width: 60px;" title="点击打开MOD路径">\
                            <span onclick="openPath(&quot;'+rdata[i].path+'&quot;)" class="glyphicon glyphicon-folder-open cursor"></span></td>\
    					<td class="wnowrap" style="max-width: 120px; width: 120px;text-align:center;" title="' + rdata[i].author + '">' + rdata[i].author + '</td>\
    					<td style="width: 100px; text-align:center;">' + rdata[i].version + '</td>\
                        <td style="text-align:right; width: 60px;">\
                            <a href="javascript:;" class="btlink del_mod">删除</a>\
                        </td>\
                        <td style="display:none;">' + rdata[i].moddir + '</td>\
                    </tr>'
                    }
                }
                $('.dstmod_table').html(_html);
            }else{
                this.create_dstcluster_mod_view(cur_cluster);
            }
        },
        
        // 创建世界环境设置视图
        create_dstshard_env_config_view: function(data, callback){
            var _html = '';
            this.get_dstshard_env_data(data, function (res) {
                var rdata = res.data;
                shard_env_data = rdata;
                rdata = rdata['overrides'];
                _html += '<div class="bt-form ceart-cluster-setting">\
                            <button class="btn btn-success btn-sm va0 mb15 save_shard_env_data" style="float:right;">保存</button>\
                            <span style="font-size: 22px; line-height: 24px;">修改存档['+ cur_cluster.name +']['+ data.shardname +']['+data.shardtype+']环境设置</span>\
                            <i style="display:block; color: red; font-size: 14px; font-style: normal; line-height: 30px;" class="help">修改完必须按保存按钮，否则更改无效</i>';
                env_index = 0;
                src_index = 0;
                food_index = 0;
                animal_index = 0;
                monster_index = 0;
                env_html = '<div class="env_title">环境</div>';
                src_html = '<div class="env_title">资源</div>';
                food_html = '<div class="env_title">食物</div>';
                animal_html = '<div class="env_title">动物</div>';
                monster_html = '<div class="env_title">怪物</div>';
                for (var i = 0; i < rdata.length; i++) {
                    var Opt = '';
                    var optarr = rdata[i].options;
        			for(var key in optarr){
    	                Opt += '<option value="'+optarr[key].value+'" ' + (rdata[i].value == optarr[key].value ? "selected" : "") +'>'+optarr[key].label+'</option>';
                    }
        			temp = '<div class="line" style="width: 210px; display: inline-flex;">\
        				    <span class="tname" style="padding: 0 8px;width:85px">' + rdata[i].label + '</span>\
        					<div class="info-r c4"><select class="'+ rdata[i].name +'-env bt-input-text" style="width:130px">'+Opt+'</select></div>\
        				  </div>';
        			if (rdata[i].type == "environment"){
        			    if (env_index > 3) {
        			        env_index = 0;
        			        env_html += '<br>';
        			    }
        			    env_html += temp;
        			    env_index++;
        			}else if (rdata[i].type == "source"){
        			    if (src_index > 3) {
        			        src_index = 0;
        			        src_html += '<br>';
        			    }
        			    src_html += temp;
        			    src_index++;
        			}else if (rdata[i].type == "animal"){
        			    if (animal_index > 3) {
        			        animal_index = 0;
        			        animal_html += '<br>';
        			    }
        			    animal_html += temp;
        			    animal_index++;
        			}else if (rdata[i].type == "food"){
        			    if (food_index > 3) {
        			        food_index = 0;
        			        food_html += '<br>';
        			    }
        			    food_html += temp;
        			    food_index++;
        			}else if (rdata[i].type == "monster"){
        			    if (monster_index > 3) {
        			        monster_index = 0;
        			        monster_html += '<br>';
        			    }
        			    monster_html += temp;
        			    monster_index++;
        			}else if(rdata[i].type == "clusterid") {
        			    _html += '<div class="line" style="display:none;">\
                                    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
    								<div class="info-r c4"><input class="'+ rdata[i].name +'-env bt-input-text" type="text" style="width:400px" value="'+ data.clusterid +'"></div>\
    						    </div>';
    			    }else if(rdata[i].type == "shardid") {
        			    _html += '<div class="line" style="display:none;">\
                                    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
    								<div class="info-r c4"><input class="'+ rdata[i].name +'-env bt-input-text" type="text" style="width:400px" value="'+ data.shardid +'"></div>\
    						    </div>';
    			    }else if(rdata[i].type == "shardtype") {
        			    _html += '<div class="line" style="display:none;">\
                                    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
    								<div class="info-r c4"><input class="'+ rdata[i].name +'-env bt-input-text" type="text" style="width:400px" value="'+ data.shardtype +'"></div>\
    						    </div>';
    			    }
    			}
    			_html += '<div class="shard_settings_config">' +env_html+src_html+food_html+animal_html+monster_html + "</div></div>";
                $('.shard_settings').html(_html);
                if (callback) callback();
            });
        },

        // 创建房间设置视图
    	create_dstcluster_settings_view: function (data){
    		var _html = '';
    		var _this = this;
    		this.get_dstserver_list(function (res) {
                sever_list = res.data;
                if(res.status){
                    _this.get_dstcluster_data({id: data.id}, function (res) {
                        var rdata = res.data;
                        cluster_data = rdata;
                        var des = '';
                        _html += '<div class="bt-form ceart-cluster-setting">\
                                    <button class="btn btn-success btn-sm va0 mb15 save_cluster_data" style="float:right;">保存</button>\
                                    <span style="font-size: 22px; line-height: 24px;">修改存档['+ data.name +']房间设置</span>\
                                    <i style="display:block; color: red; font-size: 14px; font-style: normal; line-height: 30px;" class="help">修改完必须按保存按钮，否则更改无效</i><div class="cluster_setting_config">';
                        for (var i = 0; i < rdata.length; i++) {
                            if (rdata[i].opreate == "read") {
                                if (rdata[i].name == "cluster_description") {
                                    _html += '<div class="line">\
                                                <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
                                                <div class="info-r c4" style="margin-bottom: 0;">\
                            					    <textarea style="max-width:400px; min-width:400px; max-height:150px; min-height:80px;" class="'+ rdata[i].name +' bt-input-text"></textarea>\
                            				    <i style="color: #999;font-style: normal; margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
                            			    </div>';
                            	    des = rdata[i].value;
                                }else{
                                    _html += '<div class="line">\
                                            <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
            								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:400px" value="'+ rdata[i].value +'"><i style="color: #999;font-style: normal;   margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
            						    </div>';
                                }
                            }
                            else if(rdata[i].opreate == "number") {
                                _html += '<div class="line">\
                                            <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
                                            <div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text mr5" type="number" min="0" max="65534" style="width:400px" value="'+ rdata[i].value +'"><i style="color: #999;font-style: normal;   margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
                                        </div>';
                            }
                            else if(rdata[i].opreate == "choose") {
                                var Opt = '';
                                if (rdata[i].name == "master_ip") {
                                    for (var k in sever_list){
                                        Opt += '<option value="'+sever_list[k].ip+'" ' + (rdata[i].value == sever_list[k].ip ? "selected" : "") + '>'+sever_list[k].dstserver + '@' + sever_list[k].ip+'</option>';
                                    }
                                }else{
                                    var optarr = rdata[i].options;
                			        for(var key in optarr){
            	                        Opt += '<option value="'+optarr[key].value+'" ' + (rdata[i].value == optarr[key].value ? "selected" : "") +'>'+optarr[key].label+'</option>';
                                    }
                                }
                			    _html += '<div class="line">\
                						    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
                							<div class="info-r c4"><select class="'+ rdata[i].name +' bt-input-text" style="width:400px">'+Opt+'</select><i style="color: #999;font-style: normal;   margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
                						   </div>';
            			    }
            			    else if(rdata[i].opreate == "clusterid") {
                			    _html += '<div class="line" style="display:none;">\
                                            <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
            								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:400px" value="'+ data.id +'"><i style="color: #999;font-style: normal;   margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
            						    </div>';
            			    }
                        }
                        _html += "</div></div>";
                        $('.cluster_settings').html(_html);
                        $(".cluster_description").val(des);
                    });
                }
            });
    	},

        // 配置对话框
        open_mod_config_dialog: function(data){
            var _html = '';
            var _this = this;
            this.get_mod_config_req(data, function (res) {
                var rdata = res.data;
                for (var i = 0; i < rdata.length; i++) {
                    var optarr = rdata[i].options;
                    var rdatadefault = rdata[i].default;
                    if (Array.prototype.isPrototypeOf(optarr) && optarr.length !== 0 && rdata[i].name != "clusterid" && rdata[i].name != "moddir") {
                        var Opt = '';
        			    for (var j = 0; j < optarr.length; j++) {
        			        var hover = "无说明";
        			        if (typeof optarr[j].hover != 'undefined' && optarr[j].hover != ''){
        			            hover = optarr[j].hover
        			        }
        			        var df = String(rdata[i].default);
        			        var dt = String(optarr[j].data);
    	                    Opt += '<option title="'+hover+'" value="'+dt+'" ' + (dt == df ? "selected" : "") +'>'+optarr[j].description+'</option>';
                        }
                        var hover1 = "无说明";
        			    if (typeof rdata[i].hover != 'undefined' && rdata[i].hover != ''){
        			        hover1 = rdata[i].hover
        			    }
        			    _html += '<div class="line">\
        						    <span class="tname" style="padding-right: 5px;width:200px">' + rdata[i].label + '</span>\
        							<div class="info-r c4"><select class="'+ rdata[i].name +'-mod bt-input-text" style="width:300px">'+Opt+'</select><span class="bt-ico-ask" style="cursor: pointer;" title="'+hover1+'">?</span></div>\
        						   </div>';
                    }
                }
                layer.open({
                    type: 1,
                    closeBtn: 2,
                    title: "修改MOD["+data.modname+"]配置",
                    area: '550px', //宽高
                    btn: ['确定', '取消'],
                    content: _html,
                    success: function (layero, index) {
                        // 初始化执行
                    },
                    yes: function (index, layero) {
                        var pdata = [];
                        for (var i = 0; i < rdata.length; i++) {
                            var val = $('.'+rdata[i].name+'-mod').val();
                            // console.log(val);
                            if(val != 'undefined'){
                                var item = {
                                    "name": rdata[i].name,
                                    "value": val
                                }
                                pdata.push(item);
                            }
                        }
                        pdata.push({"name": "clusterid", "value": data.clusterid});
                        pdata.push({"name": "moddir", "value": data.moddir});
                        _this.save_mod_config_req(pdata, function (res) {
                            layer.msg(res.data, {icon: res.status ? 1 : 2});
                            if (res.status) {
                                layer.close(index);
                            }
                        });
                    }
                });
            });
        },
        
        // 服务器信息对话框
        open_player_info_dialog: function (data) {
            var _this = this;
            layer.open({
                type: 1,
                closeBtn: 2,
                title: data.title,
                area: '450px', //宽高
                btn: ['确定', '取消'],
                content: '<div class="bt_conter bt-form pd15 style="height:auto;width:100%;">\
                            <div class="line"><span class="tname">KleiID</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="playerl1" placeholder="请输入KlleiID" autocomplete="off" value="' + data.kleiID + '" style="width:270px"></div>\
                            </div>\
                            <div class="line"><span class="tname">昵称</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="playerl2" placeholder="请输入昵称" autocomplete="off" value="' + data.nickname + '" style="width:270px"></div>\
                            </div>\
                            <div class="line"><span class="tname">Steam64位ID</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="playerl3" placeholder="请输入Steam64位ID" autocomplete="off" value="' + data.steamid + '" style="width:270px"></div>\
                            </div>\
                            <div class="line">\
        						<span class="tname">管理员</span>\
        					    <div class="info-r c4"><select class="bt-input-text" name="playerl4" bt-input-text" style="width:270px"><option value="true" ' + (data.admin == "true" ? "selected" : "") +'>是</option><option value="false" ' + (data.admin == "false" ? "selected" : "") +'>否</option></select></div></div>\
        					<div class="line">\
        						<span class="tname">白名单</span>\
        					    <div class="info-r c4"><select class="bt-input-text" name="playerl5" bt-input-text" style="width:270px"><option value="true" ' + (data.white == "true" ? "selected" : "") +'>是</option><option value="false" ' + (data.white == "false" ? "selected" : "") +'>否</option></select></div></div>\
        					<div class="line">\
        						<span class="tname">黑名单</span>\
        					    <div class="info-r c4"><select class="bt-input-text" name="playerl6" bt-input-text" style="width:270px"><option value="true" ' + (data.black == "true" ? "selected" : "") +'>是</option><option value="false" ' + (data.black == "false" ? "selected" : "") +'>否</option></select></div></div>\
                        </div>',
                success: function (layero, index) {
                    // 初始化执行
                },
                yes: function (index, layero) {
                    var kleiID = $('[name="playerl1"]').val(),
                        nickname = $('[name="playerl2"]').val(),
                        steamid = $('[name="playerl3"]').val(),
                        admin = $('[name="playerl4"]').val(),
                        white = $('[name="playerl5"]').val(),
                        black = $('[name="playerl6"]').val();
                    if (kleiID == '') {
                        layer.msg('请输入KlleiID', {icon: 2});
                        return false;
                    }
                    var args = {
                        "kleiID": kleiID,
                        "nickname": nickname,
                        "steamid": steamid,
                        "admin": admin,
                        "white": white,
                        "black": black,
                        "origin": data.origin
                    };
                    // console.log(args);
                    _this.edit_dstplayer_list(args, function (res) {
                        layer.msg(res.data, {icon: res.status ? 1 : 2});
                        if (res.status) {
                            layer.close(index);
                            _this.create_dstcluster_player_list_view();
                        }
                    });
                }
            });
        },

        // 服务器信息对话框
        open_server_info_dialog: function (data) {
            var _this = this;
            layer.open({
                type: 1,
                closeBtn: 2,
                title: data.title,
                area: '450px', //宽高
                btn: ['确定', '取消'],
                content: '<div class="bt_conter bt-form pd15 style="height:auto;width:100%;">\
                            <div class="line"><span class="tname">服务器名</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="dstserver_name" placeholder="请输入服务器名称" autocomplete="off" value="' + data.dstserver + '" style="width:270px"></div>\
                            </div>\
                            <div class="line"><span class="tname">IP</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="iporhost" placeholder="请输入服务器IP" autocomplete="off" value="' + data.dst_ip + '"' + (data.type == 'edit' ? "disabled='disabled'" : "") + '" style="width:270px"></div>\
                            </div>\
                            <div class="line"><span class="tname">端口号</span>\
                                <div class="info-r c4"><input name="port" class="bt-input-text mr5 port" id="dstserver_port_val" type="number" min="1" max="65534" style="width:100px" value="' + data.dst_port + '"></div>\
                            </div>\
                            <div class="line"><span class="tname">用户名</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="user_name" placeholder="请输入服务器用户名" autocomplete="off" value="' + data.username + '" style="width:270px"></div>\
                            </div>\
                            <div class="line"><span class="tname">密码</span>\
                                <div class="info-r c4"><input class="bt-input-text" type="text" name="user_paw" placeholder="请输入服务器密码" autocomplete="off" value="' + data.password + '" style="width:270px"></div>\
                            </div>\
                        </div>',
                success: function (layero, index) {
                    // 初始化执行
                },
                yes: function (index, layero) {
                    var dstserver_name = $('[name="dstserver_name"]').val(),
                        user_name = $('[name="user_name"]').val(),
                        user_paw = $('[name="user_paw"]').val(),
                        dstserver_ip = $('[name="iporhost"]').val(),
                        dstserver_port = $('#dstserver_port_val').val(),
                        req_type = data.type,
                        regEn = /[`~!@#$%^&*()_+<>?:"{},.\\/;'[\]]/im,
                        regCn = /[·！#￥（——）：；“”‘、，|《。》？、[][\]]/im;
                    if (regEn.test(dstserver_name) || regCn.test(dstserver_name)) {
                        layer.msg('服务器名称不能包含特殊字符', {icon: 2});
                        return false;
                    }
                    if (dstserver_name == '') {
                        layer.msg('请输入服务器名称', {icon: 2});
                        return false;
                    }
                    if (user_name == '') {
                        layer.msg('请输入服务器用户名', {icon: 2});
                        return false;
                    }
                    if (user_paw == '') {
                        layer.msg('请输入服务器密码', {icon: 2});
                        return false;
                    }
                    if (dstserver_ip == '') {
                        layer.msg('请输入服务器IP', {icon: 2});
                        return false;
                    }
                    if (dstserver_port == '') {
                        layer.msg('请输入服务器端口', {icon: 2});
                        return false;
                    }
                    _this.edit_dstserver_req({
                        username: user_name,
                        password: user_paw,
                        dstserver: dstserver_name,
                        ip: dstserver_ip,
                        port: dstserver_port,
                        type: req_type,
                    }, function (res) {
                        layer.msg(res.data, {icon: res.status ? 1 : 2});
                        if (res.status) {
                            layer.close(index);
                            _this.create_dstserver_view(function () {
                                layer.msg(res.data, {icon: 1});
                            })
                        }
                    });
                }
            });
        },

        // 世界信息对话框
        open_shard_info_dialog: function (data) {
            var _html = '';
            var _this = this;
            this.get_dstshard_data({clusterid: data.clusterid, shardid: data.shardid}, function (res) {
                var rdata = res.data;
                shard_data = rdata;
                var shardid = data.shardid;
                if (shardid == ""){
                    var shardid = bt.get_random(8);
                }
                for (var i = 0; i < rdata.length; i++) {
                    if (rdata[i].opreate == "read") {
                        _html += '<div class="line">\
                                    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
    								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:300px" value="'+ rdata[i].value +'"><i style="color: #999;font-style: normal; margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
    						    </div>';
                    }
                    else if(rdata[i].opreate == "number") {
                        if (rdata[i].name == "id" && rdata[i].value == ""){
                            rdata[i].value = _this.randomNum(10000,65534);
                        }
                        if (rdata[i].name == "server_port" && rdata[i].value == ""){
                            rdata[i].value = _this.randomNum(10998,11100);
                        }
                        if (rdata[i].name == "master_server_port" && rdata[i].value == ""){
                            rdata[i].value = _this.randomNum(27016,28000);
                        }
                        if (rdata[i].name == "authentication_port" && rdata[i].value == ""){
                            rdata[i].value = _this.randomNum(8767,8900);
                        }
                        _html += '<div class="line">\
                                    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
                                    <div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text mr5" type="number" min="0" max="65534" style="width:300px" value="'+ rdata[i].value +'"><i style="color: #999;font-style: normal; margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
                                </div>';
                    }
                    else if(rdata[i].opreate == "choose") {
                        var Opt = '';
                        var optarr = rdata[i].options;
        			    for(var key in optarr){
    	                    Opt += '<option value="'+optarr[key].value+'" ' + (rdata[i].value == optarr[key].value ? "selected" : "") +'>'+optarr[key].label+'</option>';
                        }
        			    _html += '<div class="line">\
        						    <span class="tname" style="padding-right: 5px;width:120px">' + rdata[i].label + '</span>\
        							<div class="info-r c4"><select class="'+ rdata[i].name +' bt-input-text" style="width:300px">'+Opt+'</select><i style="color: #999;font-style: normal; margin-left: 20px; class="help">' + rdata[i].tips + '</i></div>\
        						   </div>';
    			    }
    			    else if(rdata[i].opreate == "shardfolder") {
        			    _html += '<div class="line" style="display:none;">\
    								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:300px" value="'+ shardid +'"></div>\
    						    </div>';
    			    }
    			    else if(rdata[i].opreate == "clustershardid") {
        			    _html += '<div class="line" style="display:none;">\
    								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:300px" value="'+ data.clusterid +'"></div>\
    						    </div>';
    			    }
    			    else if(rdata[i].opreate == "shardedittype") {
        			    _html += '<div class="line" style="display:none;">\
    								<div class="info-r c4"><input class="'+ rdata[i].name +' bt-input-text" type="text" style="width:300px" value="'+ data.type +'"></div>\
    						    </div>';
    			    }
                }
                layer.open({
                    type: 1,
                    closeBtn: 2,
                    title: data.title,
                    area: '600px', //宽高
                    btn: ['确定', '取消'],
                    content: _html,
                    success: function (layero, index) {
                        // 初始化执行
                    },
                    yes: function (index, layero) {
                        for (var i = 0; i < rdata.length; i++) {
                            rdata[i].value = $('.'+rdata[i].name).val();
                        }
                        _this.edit_dstshard_req(rdata, function (res) {
                            layer.msg(res.data, {icon: res.status ? 1 : 2});
                            if (res.status) {
                                layer.close(index);
                                _this.create_dstshard_view(cur_cluster, function () {
                                    layer.msg(res.data, {icon: 1});
                                })
                            }
                        });
                    }
                });
            });
        },

        // 创建世界列表视图
        create_dstshard_view: function (data, callback) {
            $('.shard_cluster').html('存档['+ data.name +']');
            $('.cluster-shard-id').html(data.id);
            var _html = '';
            var wt = { "forest": "地面","caves": "洞穴","lavaarena": "熔炉","quagmire": "暴食"};
            this.get_dstshard_list({id: data.id}, function (res) {
                var rdata = res.data;
                for (var i = 0; i < rdata.length; i++) {
                   var sarr = rdata[i];
                    _html += '<tr>\
                        <td>' + sarr[4].value + '</td>\
                        <td style="width: 80px; text-align:center;" align="center">\
						    <span>' + (sarr[1].value == "true" ? '是':'否') +'</span>\
                        </td>\
                        <td style="width:80px; text-align:center;" align="center">\
						    <span>' + wt[sarr[2].value] +'</span>\
						</td>\
						<td style="width: 80px; text-align:center;">' + sarr[0].value + '</td>\
						<td style="width: 80px; text-align:center;">' + sarr[5].value + '</td>\
						<td style="width: 120px; text-align:center;">' + sarr[6].value + '</td>\
						<td style="width: 120px; text-align:center;">' + sarr[7].value + '</td>\
                        <td style="text-align:right; width: 160px;">\
                            <a href="javascript:;" class="btlink edit_shard_env">环境</a>&nbsp;|&nbsp;\
                            <a href="javascript:;" class="btlink edit_shard_setting">修改</a>&nbsp;|&nbsp;\
                            <a href="javascript:;" class="btlink show_shard_log">日志</a>&nbsp;|&nbsp;\
                            <a href="javascript:;" class="btlink del_shard">删除</a>\
                        </td>\
                        <td style="display:none;">' + sarr[8].value + '</td>\
                    </tr>'
                }
                $('.dstshard_table').html(_html);
                if (callback) callback();
            });
        },

        // 创建存档列表视图
        create_dstcluster_view: function (callback) {
            var _html = '';
            this.get_dstcluster_list(function (res) {
                if (res.status){
                    var rdata = res.data;
                    for (var i = 0; i < rdata.length; i++) {
                        _html += '<tr>\
                            <td>' + rdata[i].cluster_name + '</td>\
                            <!--<td style="cursor:pointer; width: 80px; text-align:center;" align="center" title="点击启动或停止" class="startorstop">\
    						    <span class="glyphicon ' + (false ? 'glyphicon-play':'glyphicon-stop') +'" style="color:'+(false?'#20a53a':'red')+';font-size:12px;position: inherit;"></span>\
    						</td>-->\
    						<td style="cursor:pointer; width: 80px; text-align:center;" align="center" class="startorstop">应用存档设置</td>\
                            <td style="text-align:center;width: 100px;" title="点击打开存档路径">\
                                <span onclick="openPath(&quot;'+rdata[i].cluster_path+'&quot;)" class="glyphicon glyphicon-folder-open cursor"></span></td>\
                            <td style="text-align:center;width: 100px;">' + rdata[i].cluster_create_time + '</td>\
                            <td style="text-align:right; width: 260px;">\
                                <a href="javascript:;" class="btlink cluster_setting">房间设置</a>&nbsp;|&nbsp;\
                                <a href="javascript:;" class="btlink shards_manager">世界管理</a>&nbsp;|&nbsp;\
                                <a href="javascript:;" class="btlink mod_manager">模组管理</a>&nbsp;|&nbsp;\
                                <a href="javascript:;" class="btlink player_list_manager">玩家管理</a><br>\
                                <a href="javascript:;" class="btlink" data-dstserver="' + rdata[i].dstserver + '" data-username="' + rdata[i].username + '" data-password="' + rdata[i].password + '" data-port="' + rdata[i].port + '"  data-ip="' + rdata[i].ip + '">备份恢复</a>&nbsp;|&nbsp;\
                                <a class="btlink console_panel" href="javascript:;">控制面板</a>&nbsp;|&nbsp;\
                                <a class="btlink download_cluster" href="javascript:;">下载存档</a>&nbsp;|&nbsp;\
                                <a href="javascript:;" class="btlink del_dstcluster">删除存档</a>\
                            </td>\
                            <td style="display:none;">' + rdata[i].cluster_folder + '</td>\
                        </tr>'
                    }
                    $('.dstcluster_table').html(_html);
                    if (callback) callback();
                }
            });
        },

        // 创建服务器列表视图
        create_dstserver_view: function (callback) {
            var _html = '';
            this.get_dstserver_list(function (res) {
                sever_list = res.data;
                var rdata = res.data;
                for (var i = 0; i < rdata.length; i++) {
                    _html += '<tr>\
                        <td>' + rdata[i].dstserver + '</td>\
                        <td style="text-align:center;width: 100px;">' + rdata[i].ip + '</td>\
                        <td style="text-align:center;width: 100px;">' + rdata[i].port + '</td>\
                        <td style="text-align:center;width: 100px;">' + rdata[i].username + '</td>\
                        <td style="text-align:center;width: 150px;">\
                            <span data-paw="' + rdata[i].password + '">******</span>\
                            <span class="glyphicon glyphicon-eye-open cursor set_paw_ico" style="margin-left:10px"></span>\
                        </td>\
                        <td style="text-align:right;width: 100px;">\
                            <a href="javascript:;" class="btlink change_dstserver" data-dstserver="' + rdata[i].dstserver + '" data-username="' + rdata[i].username + '" data-password="' + rdata[i].password + '" data-port="' + rdata[i].port + '"  data-ip="' + rdata[i].ip + '">修改</a>&nbsp;|&nbsp;\
                            <a href="javascript:;" class="btlink del_dstserver">删除</a>\
                        </td>\
                    </tr>'
                }
                $('.dstserver_table').html(_html);
                if (callback) callback();
            });
        },

        // 获取存档列表
        get_dstcluster_list: function (callback) {
            this.send({
                tips: '正在获取存档列表，请稍后...',
                method: 'get_cluster_list',
                success: function (res) {
                    if (callback) callback(res);
                }
            })
        },

        // 获取世界列表
        get_dstshard_list: function (data, callback) {
            this.send({
                tips: '正在获取世界列表，请稍后...',
                method: 'get_shard_list',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            })
        },

        // 添加存档
        add_dstcluster_req: function (data, callback) {
            this.send({
                tips: '正在新建存档，请稍后...',
                method: 'add_dstcluster',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 获取房间设置数据
        get_dstcluster_data: function (data, callback) {
            this.send({
                tips: '正在获取房间设置数据，请稍后...',
                method: 'get_cluster_data',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 获取世界设置数据
        get_dstshard_data: function (data, callback) {
            this.send({
                tips: '正在获取世界设置数据，请稍后...',
                method: 'get_shard_data',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        // 获取世界环境设置数据
        get_dstshard_env_data: function (data, callback) {
            this.send({
                tips: '正在获取世界环境设置数据，请稍后...',
                method: 'get_shard_env_data',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },


        // 获取服务器列表
        get_dstserver_list: function (callback) {
            this.send({
                tips: '正在获取服务器列表，请稍后...',
                method: 'get_server_list',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 删除存档
        del_dstcluster_req: function (data, callback) {
            this.send({
                tips: '正在删除存档，请稍后...',
                method: 'del_dst_cluster',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        // 删除世界
        del_shard_req: function (data, callback) {
            this.send({
                tips: '正在删除世界，请稍后...',
                method: 'del_dst_shard',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        // 获取存档MOD列表
        get_cluster_mod_list_req: function (data, callback) {
            this.send({
                tips: '正在获取存档MOD列表，请稍后...',
                method: 'get_all_mod_list',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 下载存档
        download_dstcluster_req: function (data, callback) {
            this.send({
                tips: '正在打包存档，请稍后...',
                method: 'download_dst_cluster',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 删除服务器
        del_dstserver_req: function (data, callback) {
            this.send({
                tips: '正在删除服务器，请稍后...',
                method: 'del_dst_server',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        get_dstplayer_list: function (callback) {
            this.send({
                tips: '正在获取玩家列表，请稍后...',
                method: 'get_player_list',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        edit_dstplayer_list: function (data, callback) {
            this.send({
                tips: '正在修改玩家信息，请稍后...',
                method: 'edit_player_list',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        del_dstplayer_list_req: function (data, callback) {
            this.send({
                tips: '正在删除玩家信息，请稍后...',
                method: 'del_player_list',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 添加服务器库请求
        edit_dstserver_req: function (data, callback) {
            var op = data.type == "add" ? "添加" : "修改";
            this.send({
                tips: '正在' + op + '服务器，请稍后...',
                method: 'edit_server',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 添加世界请求
        edit_dstshard_req: function (data, callback) {
            var op = data.type == "add" ? "添加" : "修改";
            this.send({
                tips: '正在' + op + '世界，请稍后...',
                method: 'edit_shard',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 保存房间设置
        save_cluster_data_req: function (data, callback) {
            this.send({
                tips: '正在保存房间设置，请稍后...',
                method: 'save_cluster_data',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        // 保存环境设置请求
        save_shard_env_data_req: function (data, callback) {
            this.send({
                tips: '正在保存环境设置，请稍后...',
                method: 'save_shard_env_data',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        set_sys_setting_req: function (data, callback) {
            this.send({
                tips: '正在保存设置，请稍后...',
                method: 'set_sys_setting',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        get_sys_setting_req: function (callback) {
            this.send({
                tips: '正在获取设置，请稍后...',
                method: 'get_sys_setting',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        del_mod_req: function (data, callback) {
            this.send({
                tips: '正在删除MOD，请稍后...',
                method: 'del_mod',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        switch_mod_status_req: function (data, callback) {
            this.send({
                tips: '正在处理，请稍后...',
                method: 'switch_mod_status',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        get_mod_config_req: function (data, callback) {
            this.send({
                tips: '正在获取MOD配置，请稍后...',
                method: 'get_mod_config',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        save_mod_config_req: function (data, callback) {
            this.send({
                tips: '正在保存MOD配置，请稍后...',
                method: 'set_mod_config',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        get_mod_path: function (callback) {
            this.send({
                tips: '正在获取MOD路径，请稍后...',
                method: 'get_mod_path',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        server_update_req: function(data, callback) {
            this.send({
                tips: data.tips == 'hide' ? 'hide' : '正在执行操作，请稍后...',
                method: 'server_update',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        get_server_log: function(data, callback) {
            this.send({
                tips: 'hide',
                method: 'get_server_log',
                data: data,
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        update_plugin_req: function(callback) {
            this.send({
                tips: '正在更新插件 ...',
                method: 'update_plugin',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },
        
        startorstop_server_req: function(data, callback) {
            this.send({
                tips: '正在执行 ...',
                data: data,
                method: 'create_cluster',
                success: function (res) {
                    if (callback) callback(res);
                }
            });
        },

        // 请求封装
        send: function (obj) {
            var loadT = '';
            if (obj.load == undefined) obj.load = 0;
            if (obj.url == undefined) {
                if (obj.plugin_name === undefined && this.plugin_name !== undefined) obj.plugin_name = this.plugin_name
                if (!obj.plugin_name || !obj.method) {
                    layer.msg('插件类名称，或插件方法名称缺失!', {icon: 2});
                    return false;
                }
            }
            if (obj.tips == "hide") obj.load = 2;
            if (obj.load === 0) {
                loadT = layer.msg(obj.tips, {
                    icon: 16,
                    time: 0,
                    shade: 0.3
                });
            } else if (obj.load === 1 || (obj.tips == undefined && obj.load == undefined)) {
                loadT = layer.load();
            }
            $.ajax({
                type: 'POST',
                url: obj.url != undefined ? obj.url : ('/plugin?action=a&name=' + obj.plugin_name + '&s=' + obj.method),
                data: obj.data || {},
                timeout: obj.timeout || 99999999,
                complete: function (res) {
                    if (obj.load === 0 || obj.load === 1) layer.close(loadT);
                },
                success: function (rdata) {
                    if (obj.check) {
                        obj.success(rdata);
                        return
                    }
                    if (rdata.status === false) {
                        layer.msg(rdata.data, {icon: 2});
                        return
                    }
                    obj.success(rdata);
                },
                error: function (ex) {
                    if (!obj.error) {
                        obj.msg || obj.msg == undefined ? layer.msg('请求过程发现错误!', {icon: 2}) : '';
                        return;
                    }
                    return obj.error(ex);
                }
            });
        }
    }
    dst.init();
</script>
